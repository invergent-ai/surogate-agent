<div class="flex flex-col h-full">
  <!-- Panel header -->
  <div class="flex-none flex items-center justify-between px-3 py-2 border-b border-gray-200 dark:border-zinc-800">
    <h2 class="text-xs font-semibold text-gray-600 dark:text-zinc-400 uppercase tracking-wider">Sessions</h2>
    <button
      (click)="newSessionRequested.emit()"
      class="text-xs px-2 py-0.5 rounded-md bg-amber-50 dark:bg-amber-950/30 text-amber-700 dark:text-amber-400
             hover:bg-amber-100 dark:hover:bg-amber-900/40 transition-colors font-medium"
      title="New session"
    >+ New</button>
  </div>

  <!-- Session list (scrollable) -->
  <div class="flex-1 overflow-y-auto scrollbar-thin">
    @if (sessions.length === 0) {
      <p class="text-xs text-gray-400 dark:text-zinc-500 italic px-3 py-4 text-center">No sessions yet</p>
    }
    @for (meta of sessions; track meta.sessionId) {
      <div
        class="group flex items-center gap-1 px-3 py-2 border-b border-gray-100 dark:border-zinc-800/60
               cursor-pointer transition-colors"
        [ngClass]="meta.sessionId === activeSessionId
          ? 'bg-amber-50 dark:bg-amber-950/20'
          : 'hover:bg-gray-50 dark:hover:bg-zinc-800/60'"
        (click)="editingId() !== meta.sessionId && sessionSelected.emit(meta)"
      >

        @if (editingId() === meta.sessionId) {
          <!-- In-place edit mode -->
          <input
            #editInput
            class="flex-1 min-w-0 text-xs rounded border border-amber-400 dark:border-amber-500
                   bg-white dark:bg-zinc-800 text-gray-900 dark:text-zinc-50
                   px-1.5 py-0.5 focus:outline-none"
            [value]="editingName()"
            (input)="editingName.set($any($event.target).value)"
            (keydown)="onEditKeydown($event)"
            (blur)="commitEdit()"
          />
          <button
            (mousedown)="$event.preventDefault(); commitEdit()"
            class="flex-none text-[10px] px-1.5 py-0.5 rounded bg-amber-100 dark:bg-amber-900/40
                   text-amber-700 dark:text-amber-400 hover:bg-amber-200 transition-colors"
          >âœ“</button>
        } @else {
          <!-- Normal display mode -->
          <div class="flex-1 min-w-0">
            <div class="flex items-center gap-1.5">
              @if (meta.sessionId === activeSessionId) {
                <span class="flex-none w-1.5 h-1.5 rounded-full bg-amber-400 dark:bg-amber-500"></span>
              }
              <span class="text-xs font-medium text-gray-800 dark:text-zinc-200 truncate">{{ meta.name }}</span>
            </div>
            <span class="text-[10px] text-gray-400 dark:text-zinc-500">{{ formatDate(meta.createdAt) }}</span>
          </div>

          <!-- Edit button (appears on hover) -->
          <button
            (click)="startEdit(meta, $event)"
            class="flex-none opacity-0 group-hover:opacity-100 p-1 rounded text-gray-400
                   hover:text-gray-600 dark:hover:text-zinc-300 transition-all"
            title="Rename"
          >
            <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5
                   m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
            </svg>
          </button>

          <!-- Delete button (appears on hover) -->
          <button
            (click)="onDeleteClick(meta.sessionId, $event)"
            class="flex-none opacity-0 group-hover:opacity-100 p-1 rounded text-gray-300
                   hover:text-red-400 dark:text-zinc-600 dark:hover:text-red-400 transition-all"
            title="Delete session"
          >
            <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        }
      </div>
    }
  </div>
</div>
